{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "CRI Workflow",
  "type": "object",
  "additionalProperties": false,
  "required": ["name","version","objectives","claims","inputs","steps"],
  "properties": {
    "name": {"type":"string","minLength":1},
    "version": {"type":"string"},
    "objectives": {"type":"array","items":{"type":"string"}},
    "inputs": {
      "type":"array",
      "items":{
        "type":"object","required":["path","role"],
        "properties":{
          "path":{"type":"string"},
          "role":{"type":"string","enum":["data","config","reference","code","other"]}
        }
      }
    },
    "claims": {
      "type":"array","minItems":1,
      "items":{
        "type":"object","additionalProperties":false,
        "required":["id","statement","falsification"],
        "properties":{
          "id":{"type":"string","pattern":"^[a-z0-9_\\-]+$"},
          "statement":{"type":"string"},
          "falsification":{
            "type":"object","required":["dataset","procedure","metric"],
            "properties":{
              "dataset":{"type":"string"},
              "procedure":{"type":"string"},
              "metric":{
                "type":"object","required":["name","target","tolerance"],
                "properties":{
                  "name":{"type":"string"},
                  "target":{"type":"number"},
                  "tolerance":{"type":"number"},
                  "units":{"type":"string"}
                }
              }
            }
          }
        }
      }
    },
    "steps": {
      "type":"array",
      "items":{
        "type":"object","required":["id","type"],
        "properties":{
          "id":{"type":"string","pattern":"^[a-z0-9_\\-]+$"},
          "type":{"type":"string","enum":["ingest","transform","analyze","evaluate","report"]},
          "uses":{"type":"array","items":{"type":"string"}},
          "produces":{"type":"array","items":{"type":"string"}}
        }
      }
    }
  }
}
